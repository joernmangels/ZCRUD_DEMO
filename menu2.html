<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta http-equiv='Content-Type' content='text/html;charset=UTF-8'/>

<!-- Load UI5, select gold reflection theme and the "commons" and "table" control libraries -->
  <script id='sap-ui-bootstrap' type='text/javascript'
    src='https://sapui5.hana.ondemand.com/resources/sap-ui-core.js'
    data-sap-ui-theme='sap_bluecrystal'
    data-sap-ui-libs='sap.ui.commons,sap.ui.table'></script>
        <!-- only load the mobile lib "sap.m" and the "sap_bluecrystal" theme -->
        <!-- src='https://openui5.hana.ondemand.com/resources/sap-ui-core.js' -->
        <!-- src='http://192.168.2.140/ui5/resources/sap-ui-core.js' -->    
        <script>
            //create the ApplicationHeader control
		//create the ApplicationHeader control
		var oAppHeader = new sap.ui.commons.ApplicationHeader("appHeader"); 

		//configure the branding area
		oAppHeader.setLogoSrc("http://www.sap.com/global/images/SAPLogo.gif");
		oAppHeader.setLogoText("Create, Read, Update, Delete: Contacts");

		//configure the welcome area
		oAppHeader.setDisplayWelcome(true);
		oAppHeader.setUserName("Joern Mangels");

		//configure the log off area
		oAppHeader.setDisplayLogoff(true);
            oAppHeader.placeAt("content");
            
            // setting up model
            	//var oModel = new sap.ui.model.json.JSONModel("http://192.168.2.140:8080/apiserver/api.rsc/personal", false, "cdata","6e8C4z9h5F9v5z1A5v0f");
		//var oModel = new sap.ui.model.json.JSONModel("http://192.168.2.140:8080/apiserver/api.rsc/personal/", false, "6e8C4z9h5F9v5z1A5v0f");
		// var oModel = new sap.ui.model.odata.v2.ODataModel("http://192.168.2.140:8080/apiserver/api.rsc/personal/",{user: "cdata", password: "6e8C4z9h5F9v5z1A5v0f"});            
		// var oModel = new sap.ui.model.odata.v2.ODataModel("http://192.168.2.140:8080/apiserver/api.rsc/personal/",{"@authtoken": "6e8C4z9h5F9v5z1A5v0f"});            

		// var oModel = new sap.ui.model.odata.v2.ODataModel("http://192.168.2.140:8080/apiserver/api.rsc/personal/",{"@authtoken": "6e8C4z9h5F9v5z1A5v0f"});            
		//oModel.attachMetadataLoaded(null, function(){
		//   var oMetadata = oModel.getServiceMetadata();
		//   console.log(oMetadata);
		//},null);
		//oModel.getMetaModel().loaded().then(function(){
		//	sap.ui.getCore().setModel(oModel.getMetaModel(), "metadata");
		//});

		//sap.ui.getCore().setModel(oModel);
            
    //var oModel = new sap.ui.model.odata.v2.ODataModel("http://192.168.2.140:8080/apiserver/api.rsc/personal",{user: "cdata", password: "6e8C4z9h5F9v5z1A5v0f"});

////oModel.getMetaModel().loaded().then(function(){
//sap.ui.getCore().setModel(oModel.getMetaModel(), "meta");
////});
//sap.ui.getCore().setModel(oModel);


            // setting up model
//            var oModel = new sap.ui.model.json.JSONModel("http://192.168.2.140:8080/apiserver/api.rsc/personal", false);
//            sap.ui.getCore().setModel(oModel);
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
//Create an instance of sap.ui.model
//              var oModel = new sap.ui.model.json.JSONModel();
//            // Fire the "OData.read" request
//              sap.ui.model.odata.v2.ODataModel.read({ requestUri: "http://192.168.2.140:8080/apiserver/api.rsc/personal",
//                            headers: { Authorization : 'Basic ' + btoa("cdata" + ":" + "6e8C4z9h5F9v5z1A5v0f") }, },
//                            function (data) // data is the data model returned on Successful read request
//                            {
//                                var myData = {}; // Create an instance to store the OData Model
//                                myData.results = data.results; // data.results hold the data returned from the Service
//                                //Store the OModel
//                                oModel.setData(myData);
//                                sap.ui.getCore().setModel(oModel);
//                                //To retrieve data from the OModel
//                                var mailadresse=myData.results[0].email;
//                                alert("Email : " + mailadresse;
//                            },
//                            function(err)
//                            {
//                                alert("Error !!!");
//                            }
//                         );
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
//        $.get("http://192.168.2.140:8080/apiserver/api.rsc/personal2/", { "@authtoken": "6e8C4z9h5F9v5z1A5v0f" }, function(data) {
//          $("#result").html(JSON.stringify(data));
//        });
//        var sServiceUrl = "http://192.168.2.140:8080/apiserver/api.rsc/$metadata#personal2";
//        var oOdataModel = new sap.ui.model.odata.v2.ODataModel(sServiceUrl,{"@authtoken": "6e8C4z9h5F9v5z1A5v0f"},
//                              function(data) {
//                                                $("#result").html(JSON.stringify(data));
//                                             });
                           
        //var oView = this.getView();
//        var oModel = new sap.ui.model.json.JSONModel();
//        var aAddress = [];
        
        //set odata models
//        var readAdr = oOdataModel.read("results",{
//            success : function(oData,response){
//                oModel.setData(oData);
                //oView.setModel(oEmployeeModel,"EmployeeModel");
//                sap.ui.getCore().setModel(oModel);
//                aAddress = oModel.getData().results;
//            },
//            error : function(oError){
//                console.log(oError);
//            }
//        });

//        var aFilters = [new Filter("PersNo",FilterOperator.NE,"00000000")];
//        var readOp = oOdataModel.read("/OrderOperationSet",{
//            filters : aFilters,
//            success : function(oData,response){
//                oOperationModel.setData(oData);
//                oView.setModel(oOperationModel,"OperationModel");
//                aOperations = oOperationModel.getData().results;
//            },
//            error : function(oError){
//                console.log(oError);
//            }
//        });
/////////////////////////////////////////////////////////////////////////////////////////////////////////////
          //var sServiceUrl = "http://192.168.2.100:8080/apiserver/api.rsc/personal2/";
          //var sServiceUrl = "http://192.168.2.140:8080/apiserver/api.rsc/?@authtoken=0s7C4h0j9E7k1r2J4o4f/personal2/";
          var sServiceUrl = "http://192.168.2.140:8080/apiserver/api.rsc/personal2/?@authtoken=0s7C4h0j9E7k1r2J4o4f";
          //var oDataModel = new sap.ui.model.odata.v2.ODataModel(sServiceUrl,{user: "joern", password: "6q5D1y1h5S5p2e7J9j5i"});
          var _headers = {
              "x-cdata-authtoken": "9d4K9w7h4F8g6w3L8p1g"
               //              "@authtoken": "9d4K9w7h4F8g6w3L8p1g"
          };
          
//          var oModel = new sap.ui.model.odata.v2.ODataModel(sServiceUrl,{user: "admin", password: "9d4K9w7h4F8g6w3L8p1g"}); 
//                                                                          headers: _headers});
  
          var oModel = new sap.ui.model.odata.v2.ODataModel(sServiceUrl,{useBatch: false, user: "joern", password: "0s7C4h0j9E7k1r2J4o4f"});
          //var oModel = new sap.ui.model.odata.v2.ODataModel(sServiceUrl,{"@authtoken": "9d4K9w7h4F8g6w3L8p1g", headers: _headers});  
                                                                          
          //oDataModel.setHeaders({"x-cdata-authtoken" : "6q5D1y1h5S5p2e7J9j5i"});
          //var oDataModel = new sap.ui.model.odata.v2.ODataModel("http://192.168.2.140:8080/apiserver/api.rsc/personal/",{"@authtoken": "6q5D1y1h5S5p2e7J9j5i"}); 
          oModel.getMetaModel().loaded().then(function(){
              sap.ui.getCore().setModel(oModel);
          });

/////////////////////////////////////////////////////////////////////////////////////////////////////////////
            /*****   CREATE Operation  *****/
            function openCreateDialog(){ 
                var oCreateDialog = new sap.ui.commons.Dialog();
                oCreateDialog.setTitle("Create user");
                var oSimpleForm = new sap.ui.layout.form.SimpleForm({
                    maxContainerCols: 2,
                    content:[
                        new sap.ui.core.Title({text:"Person"}),
                        new sap.ui.commons.Label({text:"Email"}),
                        new sap.ui.commons.TextField({value:""}),
                        new sap.ui.commons.Label({text:"Firstname"}),
                        new sap.ui.commons.TextField({value:""}),
                        new sap.ui.commons.Label({text:"Lastname"}),
                        new sap.ui.commons.TextField({value:""}),
                        new sap.ui.commons.Label({text:"Age"}),
                        new sap.ui.commons.TextField({value:""}),
                        new sap.ui.commons.Label({text:"Address"}),
                        new sap.ui.commons.TextField({value:""}),
                    ]
                });                
                oCreateDialog.addContent(oSimpleForm);
                oCreateDialog.addButton(
                    new sap.ui.commons.Button({
                        text: "Submit", 
                        press: function() {
                            var content = oSimpleForm.getContent();
                            var oEntry = {};
                            oEntry.Email = content[2].getValue();
                            oEntry.Firstname = content[4].getValue();
                            oEntry.Lastname = content[6].getValue();
                            oEntry.Age = content[8].getValue();
                            oEntry.Address = content[10].getValue();
                            
                            // Post data to the server
                            oModel.loadData("http://192.168.2.140/crud/adddata.php", oEntry, true, 'POST');
							location.reload();	
                        }
                    })
                );
                oCreateDialog.open();
            };        
            
            /*****   PUT Operation  *****/
            function openUpdateDialog(user){ 
                var oUpdateDialog = new sap.ui.commons.Dialog();
                oUpdateDialog.setTitle("Update user's data");
                var oSimpleForm = new sap.ui.layout.form.SimpleForm({
                    maxContainerCols: 2,
                    content:[
                        new sap.ui.core.Title({text:"Person"}),
                        new sap.ui.commons.Label({text:"Email"}),
                        new sap.ui.commons.TextField({value: user[0].getValue(), editable: false}),
                        new sap.ui.commons.Label({text:"Firstname"}),
                        new sap.ui.commons.TextField({value: user[1].getValue()}),
                        new sap.ui.commons.Label({text:"Lastname"}),
                        new sap.ui.commons.TextField({value: user[2].getValue()}),
                        new sap.ui.commons.Label({text:"Age"}),
                        new sap.ui.commons.TextField({value: user[3].getValue()}),
                        new sap.ui.commons.Label({text:"Address"}),
                        new sap.ui.commons.TextField({value: user[4].getValue()}),
                    ]
                });                
                oUpdateDialog.addContent(oSimpleForm);
                oUpdateDialog.addButton(
                    new sap.ui.commons.Button({
                        text: "Submit", 
                        press: function() {
                            var content = oSimpleForm.getContent();
                            var oEntry = {};
                            oEntry.Email = content[2].getValue();
                            oEntry.Firstname = content[4].getValue();
                            oEntry.Lastname = content[6].getValue();
                            oEntry.Age = content[8].getValue();

                            oEntry.Address = content[10].getValue();
                            // Post data to the server
                            oModel.loadData("http://192.168.2.140/crud/editdata.php?email=oEntry.Email", oEntry, true, 'POST');						      oUpdateDialog.close();
								location.reload();								   
                        }
                    })
                );
                oUpdateDialog.open();
            };
            
            /*****   DELETE Operation  *****/
            function openDeleteDialog(user) { 
                var oDeleteDialog = new sap.ui.commons.Dialog();
                oDeleteDialog.setTitle("Delete user");
                var oSimpleForm = new sap.ui.layout.form.SimpleForm({
                    maxContainerCols: 2,
                    content:[
                        new sap.ui.core.Title({text:"Person"}),
                        new sap.ui.commons.Label({text:"Email"}),
                        new sap.ui.commons.TextField({value: user[0].getValue(), editable: false}),
                        new sap.ui.commons.Label({text:"Firstname"}),
                        new sap.ui.commons.TextField({value: user[1].getValue(), editable: false}),
                        new sap.ui.commons.Label({text:"Lastname"}),
                        new sap.ui.commons.TextField({value: user[2].getValue(), editable: false}),
                        new sap.ui.commons.Label({text:"Age"}),
                        new sap.ui.commons.TextField({value: user[3].getValue(), editable: false}),
                        new sap.ui.commons.Label({text:"Address"}),
                        new sap.ui.commons.TextField({value: user[4].getValue(), editable: false}),
                    ]
                });                
                oDeleteDialog.addContent(oSimpleForm);
                oDeleteDialog.addButton(
                    new sap.ui.commons.Button({
                        text: "Submit", 
                        press: function() {
                            var content = oSimpleForm.getContent();
                            var oEntry = {};
                            oEntry.Email = content[2].getValue();
                            oEntry.Firstname = content[4].getValue();
                            oEntry.Lastname = content[6].getValue();
                            oEntry.Age = content[8].getValue();

                            oEntry.Address = content[10].getValue();
                            // Post data to the server
                            oModel.loadData("http://192.168.2.140/crud/deletedata.php?email=oEntry.Email", oEntry, true, 'POST');	 							   
								oDeleteDialog.close();
								location.reload();	
                        }
                    })
                );
                oDeleteDialog.open();
            };
            // setting up table
            var oTable = new sap.ui.table.Table({
                editable: false,
                toolbar: new sap.ui.commons.Toolbar({ 
                    items: [ 
                        new sap.ui.commons.Button({
                            text: "Create user", 
                            press: function() {
                                openCreateDialog();
                            }, 
                        }),
                        new sap.ui.commons.Button({
                            text: "Update user's data", 
                            press: function() {
                                var idx = oTable.getSelectedIndex();
                                if (idx == -1) return;
                                var rows = oTable.getRows();
                                var user = rows[idx].getCells();
                                openUpdateDialog(user);
                            }, 
                        }),
                        new sap.ui.commons.Button({
                            text: "Delete user", 
                            press: function() {
                                var idx = oTable.getSelectedIndex();
                                if (idx == -1) return;
                                var rows = oTable.getRows();
                                var user = rows[idx].getCells();
                                openDeleteDialog(user);
                            }, 
                        })				
                    ]
                }),
            });
        
            oTable.addColumn(new sap.ui.table.Column({
                label: new sap.ui.commons.Label({text: "Email"}),
                template: new sap.ui.commons.TextField().bindProperty("value", "email"),
                editable: false,
                sortProperty: "email"
            }));
        
            oTable.addColumn(new sap.ui.table.Column({
                label: new sap.ui.commons.Label({text: "Firstname"}),
                template: new sap.ui.commons.TextField().bindProperty("value", "firstname"),
                sortProperty: "firstname",
                editable: false,
            }));
        
            oTable.addColumn(new sap.ui.table.Column({
                label: new sap.ui.commons.Label({text: "Lastname"}),
                template: new sap.ui.commons.TextField().bindProperty("value", "lastname"),
                sortProperty: "lastname",
                editable: false,
            }));
        
            oTable.addColumn(new sap.ui.table.Column({
                label: new sap.ui.commons.Label({text: "Age"}),
                template: new sap.ui.commons.TextField().bindProperty("value", "age"),
                sortProperty: "age",
                editable: false,
            }));
        
            oTable.addColumn(new sap.ui.table.Column({
                label: new sap.ui.commons.Label({text: "Address"}),
                template: new sap.ui.commons.TextField().bindProperty("value", "address"),
                sortProperty: "address",
                editable: false,
            }));
            
            
            oTable.setModel(oModel);
            oTable.bindRows("/");
            oTable.placeAt("content");
        
        </script>

    </head>
    <body class="sapUiBody" role="application">
        <div id="content"></div>
    </body>
</html>